(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,1030,e=>{"use strict";var n,i,t=((n={}).Production="production",n.Development="development",n.Staging="staging",n),a=((i={}).InstanceKey="instance_key",i.PublicKey="public_key",i.PublicKeyPEM="public_key_pem",i.FapiKey="fapi_key",i.SecretKey="secret_key",i);e.s(["EnvironmentType",()=>t,"InstanceKeyObject",()=>a])},165159,e=>{"use strict";var n=e.i(73677),i=e.i(997210),t=e.i(411048),a=e.i(1030),o=e.i(475609),r=e.i(548011),s=e.i(721376),l=e.i(901025),c=e.i(685262),d=e.i(375467),u=e.i(247854),p=e.i(70038),h=e.i(995304),m=e.i(109821),g=e.i(16589),f=e.i(706537),x=e.i(758040),y=e.i(104477),j=e.i(237206),v=e.i(942976),_=e.i(683471),b=e.i(184260),C=e.i(873236);let P=(0,b.forwardRef)(function({instances:e,showUpgradeModal:P,track:k},D){let{getToken:I}=(0,x.useAuth)(),{close:T}=(0,m.useDialog)(),{applicationId:B}=(0,_.useParams)(),[A,E]=(0,b.useState)("select-method"),[S,R]=(0,b.useState)(!1),K=(0,_.useRouter)(),{parse:F}=(0,l.useTLDParser)(),{getAddonsFromInstanceFeatures:M,isEnabled:O,openCheckout:U,closeModal:Q}=(0,o.useNewPricing)(),$=(0,j.useQueryClient)(),N=b.default.useMemo(()=>e?e.filter(e=>e.environment_type!==a.EnvironmentType.Production).sort(w):[],[e]),V=N[0]?.id,q=(0,s.useDialogForm)({defaultValues:{clone_instance_id:V,home_url:"",is_secondary:!1},onSubmit:async({value:e})=>{let{clone_instance_id:n,home_url:t,is_secondary:a}=e,o=`https://${(0,c.stripProtocol)(t)}`,r=await (0,i.createProductionInstance)(B,{clone_instance_id:"default"===n?null:n,home_url:o,is_secondary:a},{getToken:I});await $.invalidateQueries({queryKey:["applications"]}),K.push(`/apps/${B}/instances/${r.id}`)}}),{Field:G,getFieldValue:H,Subscribe:L}=q,z=H("clone_instance_id"),J="default"===z?void 0:z,{data:W}=(0,y.useQuery)({...(0,t.extendedInstanceQuery)(J,{getToken:I}),enabled:!!J}),X=async()=>{if("default"===H("clone_instance_id"))await new Promise(e=>setTimeout(e,0)),E("configure");else{R(!0);try{await (0,i.validateCloning)(B,H("clone_instance_id"),{getToken:I}),E("configure")}catch(e){if(e instanceof r.HTTPError&&402===e.code){let n=e.errorMeta.filter(e=>e.unsupported_features).flatMap(e=>e.unsupported_features).filter(Boolean);O?U({addOnIds:M(n,W?.features||{}),onCheckoutComplete:()=>{E("configure"),Q("checkout")},onAddOnComplete:()=>{E("configure"),Q("addAddOn")}}):(T(),P({features:n,callbackAfterUpgrade:()=>{E("configure")}}));return}throw e}finally{R(!1)}}};return(0,n.jsxs)("form",{ref:D,...q.formProps,children:[(0,n.jsxs)(m.DialogContent,{children:[(0,n.jsx)(m.DialogHeader,{title:"Create production instance",description:(0,n.jsx)(h.Collapsible,{clip:!0,children:"configure"===A&&(0,n.jsxs)(n.Fragment,{children:["Learn more about"," ",(0,n.jsx)(v.default,{href:"https://clerk.com/docs/guides/development/deployment/production",target:"_blank",rel:"noopener",children:"deploying to production"}),"."]})})}),(0,n.jsx)(d.AnimateChildren,{children:"select-method"===A?(0,n.jsx)(m.DialogBody,{children:(0,n.jsx)(m.DialogSection,{children:(0,n.jsx)(G,{name:"clone_instance_id",children:e=>(0,n.jsxs)(g.RadioGroup,{name:e.name,value:e.state.value,onChange:e.handleChange,children:[...N.map(e=>(0,n.jsx)(g.Radio,{label:(0,n.jsxs)(n.Fragment,{children:["Clone ",e.environment_type," instance"," ",(0,n.jsx)(u.Badge,{children:"Easiest"})]}),value:e.id,description:`Authentication and theme settings will be copied from the ${e.environment_type} instance. Usage of premium features will require a plan upgrade.`},e.id)),(0,n.jsx)(g.Radio,{label:"Create default instance",value:"default",description:"Use the default authentication and theme settings."})]})})})},0):(0,n.jsx)(m.DialogBody,{children:(0,n.jsxs)(m.DialogSection,{children:[(0,n.jsx)(G,{name:"home_url",validators:{onSubmit:C.z.string().regex(/.+\..+/,{message:"Enter a valid application domain"})},children:e=>(0,n.jsx)(f.TextField,{label:"Application domain",description:"Enter the full application domain where your application lives. Include the subdomain, if applicable.",placeholder:"e.g. example.com",autoFocus:!0,value:e.state.value,onChange:e.handleChange,errors:e.state.meta.errors,children:(0,n.jsx)(f.Input,{start:"https://"})})}),(0,n.jsx)(L,{selector:e=>e.values.home_url,children:e=>{let i=F(e);return(0,n.jsx)(h.Collapsible,{clip:!0,children:i.subdomain&&(0,n.jsx)("div",{className:"pt-4",children:(0,n.jsx)("div",{className:"rounded-lg bg-ceramic-gray-100 p-4 dark:bg-ceramic-gray-1200",children:(0,n.jsx)(G,{name:"is_secondary",children:e=>(0,n.jsxs)(g.RadioGroup,{label:(0,n.jsxs)("span",{children:["Is this the primary application for"," ",(0,n.jsx)("strong",{children:i.domain})," or a secondary application?"]}),name:e.name,value:e.state.value?"true":"false",onChange:n=>e.handleChange("true"===n),children:[(0,n.jsx)(g.Radio,{label:"Primary application",value:"false",description:(0,n.jsxs)("ul",{children:[(0,n.jsxs)("li",{children:["Clerk's API will be hosted on"," ",(0,n.jsxs)("strong",{children:["clerk.",i.domain]})]}),(0,n.jsxs)("li",{children:["Verification emails will be sent from @",(0,n.jsx)("strong",{children:i.domain})]})]})}),(0,n.jsx)(g.Radio,{label:"Secondary application",value:"true",description:(0,n.jsxs)("ul",{children:[(0,n.jsxs)("li",{children:["Clerk's API will be hosted on"," ",(0,n.jsxs)("strong",{children:["clerk.",i.hostname]})]}),(0,n.jsxs)("li",{children:["Verification emails will be sent from @",(0,n.jsx)("strong",{children:i.hostname})]})]})})]})})})})})}})]})},1)}),q.notices]}),(0,n.jsx)(m.DialogFooter,{secondaryButton:"configure"===A?(0,n.jsx)(p.Button,{onPress:()=>{E("select-method")},children:"Back"}):void 0,button:"select-method"===A?(0,n.jsx)(p.Button,{"data-analytics":"create-production-instance",onPress:X,isPending:S,children:"Continue"}):(0,n.jsx)(p.Button,{...q.submitButtonProps,onPress:()=>{k("Dashboard_Create Production Instance Modal_Create Instance Button Clicked",{location:"Instance Modal",surface:"Dashboard",instance_creation_type:"default"===H("clone_instance_id")?"create-default":"clone-existing"})},children:"Create Instance"})})]})}),k={[a.EnvironmentType.Development]:0,[a.EnvironmentType.Staging]:1,[a.EnvironmentType.Production]:2},w=(e,n)=>void 0===e.environment_type?1:void 0===n.environment_type?-1:k[e.environment_type]-k[n.environment_type];e.s(["default",0,P])}]);